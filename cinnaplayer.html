<link rel="icon" type="image/png" href="oi.png">
<div id="mediaPlayer" class="window" style="width:720px;">
  <div class="title-bar">CinnaOS Media Player</div>
  <div class="content">
    <!-- Video/Audio Player -->
    <video id="player" width="720" height="405" controls style="display:none;">
      Your browser does not support video playback :(.
    </video>

    <!-- YouTube Embed -->
    <div id="youtubeContainer" style="width:720px; height:405px; display:none;">
      <iframe id="youtubeFrame" width="720" height="405" frameborder="0" allowfullscreen></iframe>
    </div>
    <br>

    <!-- File Input -->
    <input type="file" id="fileInput" accept="audio/*,video/*" multiple>
    <button id="saveBtn" disabled>Save Video Link</button>
    <br><br>

    <!-- URL Input -->
    <input type="text" id="urlInput" placeholder="Enter YouTube URL" style="width:60%;">
    <button id="loadURL">Add to Playlist</button>
    <br><br>

    <!-- Playlist -->
    <div id="playlist" style="max-height:150px; overflow-y:auto; border:1px solid #ccc; padding:5px; background:#f9f9f9;">
      <b>Playlist:</b>
      <ul id="playlistItems" style="list-style:none; padding-left:0;"></ul>
    </div>
  </div>
</div>

<script>
const fileInput = document.getElementById("fileInput");
const player = document.getElementById("player");
const saveBtn = document.getElementById("saveBtn");
const urlInput = document.getElementById("urlInput");
const loadURL = document.getElementById("loadURL");
const youtubeContainer = document.getElementById("youtubeContainer");
const youtubeFrame = document.getElementById("youtubeFrame");
const playlistItems = document.getElementById("playlistItems");

let playlist = []; // array of {type: "file"/"link", name, src}
let currentIndex = -1;

// --- Play selected item ---
function playItem(index) {
  if (index < 0 || index >= playlist.length) return;
  currentIndex = index;
  const item = playlist[index];

  if (item.type === "file") {
    player.src = item.src;
    player.style.display = "block";
    youtubeContainer.style.display = "none";
    player.play();
    saveBtn.disabled = true;
  } else if (item.type === "link") {
    youtubeFrame.src = `https://www.youtube.com/embed/${item.id}`;
    youtubeContainer.style.display = "block";
    player.style.display = "none";
    saveBtn.disabled = false;
  }

  // highlight selected
  [...playlistItems.children].forEach((li, i) => {
    li.style.background = i === currentIndex ? "#ddd" : "transparent";
  });
}

// --- Add file(s) to playlist ---
fileInput.addEventListener("change", (event) => {
  for (const file of event.target.files) {
    const url = URL.createObjectURL(file);
    const item = {type:"file", name:file.name, src:url};
    playlist.push(item);

    const li = document.createElement("li");
    li.textContent = file.name;
    li.style.cursor = "pointer";
    li.onclick = () => playItem(playlist.indexOf(item));
    playlistItems.appendChild(li);
  }
  if (currentIndex === -1 && playlist.length > 0) playItem(0);
});

// --- Add YouTube link to playlist ---
loadURL.addEventListener("click", () => {
  const url = urlInput.value.trim();
  if (!url) return alert("Enter a YouTube URL!");
  
  const match = url.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})/);
  if (!match) return alert("Invalid YouTube URL!");
  
  const videoID = match[1];
  const item = {type:"link", name:"YouTube Video ("+videoID+")", id:videoID, src:`https://www.youtube.com/watch?v=${videoID}`};
  playlist.push(item);

  const li = document.createElement("li");
  li.textContent = item.name;
  li.style.cursor = "pointer";
  li.onclick = () => playItem(playlist.indexOf(item));
  playlistItems.appendChild(li);

  if (currentIndex === -1) playItem(0);
  urlInput.value = "";
});

// --- Save current link ---
saveBtn.addEventListener("click", () => {
  if (currentIndex < 0) return alert("Nothing playing!");
  const item = playlist[currentIndex];
  if (item.type !== "link") return alert("Only links can be saved!");

  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([item.src], {type:"text/plain"}));
  a.download = item.name.replace(/\s+/g,"_") + ".txt";
  a.click();
});
</script>
